{{- $title := .Title -}}
{{- $description := .Description -}}
{{- $author := .Site.Params.author | default "Nischal Skanda" -}}
{{- $keywords := .Site.Params.keywords -}}

{{- if .IsHome -}}
    {{- $title = .Site.Params.metaTitle | default .Site.Title -}}
    {{- $description = .Site.Params.metaDescription | default .Site.Params.description -}}
{{- else if .IsPage -}}
    {{- $title = printf "%s | %s" .Title .Site.Title -}}
    {{- if not $description -}}
        {{- $description = .Summary | plainify | truncate 160 -}}
    {{- end -}}
{{- end -}}

<!-- Basic Meta Tags -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="{{ $description }}">
<meta name="keywords" content="{{ delimit $keywords ", " }}">
<meta name="author" content="{{ $author }}">
<meta name="robots" content="index, follow">
<meta name="language" content="{{ .Site.LanguageCode }}">

<!-- Title -->
<title>{{ $title }}</title>

<!-- Canonical URL -->
<link rel="canonical" href="{{ .Permalink }}">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
<meta property="og:url" content="{{ .Permalink }}">
<meta property="og:title" content="{{ $title }}">
<meta property="og:description" content="{{ $description }}">
<meta property="og:site_name" content="{{ .Site.Title }}">
<meta property="og:locale" content="{{ .Site.LanguageCode }}">

{{- if .IsPage -}}
<meta property="article:author" content="{{ $author }}">
<meta property="article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
{{- if .Lastmod -}}
<meta property="article:modified_time" content="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}">
{{- end -}}
{{- range .Params.tags -}}
<meta property="article:tag" content="{{ . }}">
{{- end -}}
{{- end -}}

<!-- Twitter Card -->
<meta name="twitter:card" content="{{ .Site.Params.twitterCard | default "summary_large_image" }}">
{{- with .Site.Params.twitter -}}
<meta name="twitter:site" content="{{ . }}">
<meta name="twitter:creator" content="{{ . }}">
{{- end -}}
<meta name="twitter:title" content="{{ $title }}">
<meta name="twitter:description" content="{{ $description }}">

<!-- Images for social media -->
{{- $ogImage := "" -}}
{{- if .Params.featured_image -}}
    {{- $ogImage = .Params.featured_image -}}
{{- else if .Site.Params.ogImage -}}
    {{- $ogImage = .Site.Params.ogImage -}}
{{- else -}}
    {{- $ogImage = "/images/og-default.jpg" -}}
{{- end -}}

{{- if $ogImage -}}
<meta property="og:image" content="{{ $ogImage | absURL }}">
<meta name="twitter:image" content="{{ $ogImage | absURL }}">
{{- end -}}

<!-- Additional SEO Meta Tags -->
<meta name="theme-color" content="#0099FF">
<meta name="msapplication-TileColor" content="#0099FF">

<!-- Structured Data (JSON-LD) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "{{ if .IsPage }}BlogPosting{{ else }}Blog{{ end }}",
  {{- if .IsPage -}}
  "headline": "{{ .Title }}",
  "description": "{{ $description }}",
  "author": {
    "@type": "Person",
    "name": "{{ $author }}",
    "url": "{{ .Site.Params.mainSiteURL }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ .Site.Title }}",
    "url": "{{ .Site.BaseURL }}"
  },
  "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
  {{- if .Lastmod -}}
  "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
  {{- end -}}
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ .Permalink }}"
  },
  {{- if $ogImage -}}
  "image": "{{ $ogImage | absURL }}",
  {{- end -}}
  "keywords": [{{ range $index, $tag := .Params.tags }}{{ if $index }}, {{ end }}"{{ $tag }}"{{ end }}],
  "articleSection": [{{ range $index, $cat := .Params.categories }}{{ if $index }}, {{ end }}"{{ $cat }}"{{ end }}]
  {{- else -}}
  "name": "{{ .Site.Title }}",
  "description": "{{ .Site.Params.description }}",
  "url": "{{ .Site.BaseURL }}",
  "author": {
    "@type": "Person",
    "name": "{{ $author }}",
    "url": "{{ .Site.Params.mainSiteURL }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ .Site.Title }}",
    "url": "{{ .Site.BaseURL }}"
  }
  {{- end -}}
}
</script>

<!-- Performance Hints -->
<link rel="dns-prefetch" href="//vercel.com">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//www.google-analytics.com">
<link rel="dns-prefetch" href="//www.googletagmanager.com">
<link rel="preconnect" href="{{ .Site.Params.mainSiteURL }}">
<link rel="preconnect" href="https://vercel.com" crossorigin>
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<!-- Critical CSS inlining for immediate rendering -->
<style>
  /* Critical CSS Variables with Theme Support */
  :root {
    --background-color: #F8F7F3;
    --text-color: #1a1a1a;
    --accent-color-blue: #0099FF;
    --accent-color-yellow: #FFD700;
    --surface-color: #ffffff;
    --border-color: rgba(0, 0, 0, 0.1);
    --shadow-color: rgba(0, 0, 0, 0.1);
    --post-border: #e0e0e0;
    --glass-bg: rgba(255, 255, 255, 0.2);
    --glass-border: rgba(255, 255, 255, 0.3);
  }
  
  [data-theme="dark"] {
    --background-color: #0a0a0a;
    --text-color: #f5f5f5;
    --accent-color-blue: #00B4FF;
    --accent-color-yellow: #FFD700;
    --surface-color: #1a1a1a;
    --border-color: rgba(255, 255, 255, 0.1);
    --shadow-color: rgba(0, 0, 0, 0.3);
    --post-border: #333333;
    --glass-bg: rgba(255, 255, 255, 0.05);
    --glass-border: rgba(255, 255, 255, 0.1);
  }
  
  /* Critical Base Styles */
  * { box-sizing: border-box; }
  
  body { 
    margin: 0; 
    padding-top: 80px;
    background-color: var(--background-color);
    color: var(--text-color);
    font-family: 'Satoshi', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  
  /* Critical Header Styles */
  .site-header { 
    position: fixed; 
    top: 0; 
    left: 0; 
    right: 0; 
    z-index: 1000;
    background: rgba(248, 247, 243, 0.95); 
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    display: flex; 
    justify-content: center; 
    align-items: center; 
    padding: 20px 40px;
    border-bottom: 1px solid var(--border-color);
  }
  
  [data-theme="dark"] .site-header {
    background: rgba(10, 10, 10, 0.95);
  }
  
  /* Critical Logo Styles */
  .logo { 
    font-weight: 700; 
    font-size: 1.5rem; 
    position: absolute; 
    left: 50%; 
    transform: translateX(-50%);
    color: var(--text-color);
    text-decoration: none;
    font-family: 'Unbounded', sans-serif;
  }
  
  /* Critical Hero Styles */
  .hero-headline { 
    font-size: 4.2rem; 
    line-height: 1.1; 
    text-transform: uppercase; 
    font-weight: 700;
    color: var(--text-color);
    font-family: 'Unbounded', sans-serif;
    margin: 0;
  }
  
  /* Critical Interactive Shapes */
  .interactive-o {
    display: inline-block;
    width: 1.5em;
    height: 0.6em;
    background: linear-gradient(120deg, var(--accent-color-yellow), var(--accent-color-blue));
    border-radius: 50px;
    vertical-align: middle;
    margin: 0 -0.05em;
    position: relative;
    top: -0.1em;
  }
  
  .interactive-arrow {
    display: inline-block !important;
    width: 2.5em !important;
    height: 2.5em !important;
    background: linear-gradient(160deg, var(--accent-color-blue), #6DD5FA) !important;
    clip-path: polygon(0% 0%, 100% 0%, 100% 50%, 50% 100%, 0% 50%) !important;
    vertical-align: middle !important;
    position: relative !important;
    top: 0.1em !important;
    margin-left: -0.2em !important;
  }
  
  /* Critical Container Styles */
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 40px;
  }
  
  /* Critical Theme Toggle Styles */
  .theme-toggle {
    position: absolute;
    left: 40px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px 12px;
    border-radius: 6px;
    color: var(--text-color);
    font-family: inherit;
    font-size: 0.9rem;
  }
  
  .theme-text {
    display: none;
  }
  
  .theme-text-light {
    display: inline;
  }
  
  [data-theme="dark"] .theme-text-light {
    display: none;
  }
  
  [data-theme="dark"] .theme-text-dark {
    display: inline;
  }
  
  /* Critical Main Site Link Styles */
  .main-site-link {
    position: absolute;
    right: 40px;
    color: var(--text-color);
    text-decoration: none;
    font-size: 0.9rem;
    padding: 8px 12px;
    border-radius: 6px;
    transition: background-color 0.1s ease;
  }
  
  /* Critical Hero Section Styles */
  .hero-section {
    padding: 80px 0 60px;
    text-align: center;
  }
  
  /* Critical Hero Arrow Styles */
  .hero-arrow {
    margin-top: 20px;
    text-align: center;
  }
  

  
  /* Critical Post List Styles */
  .post-list {
    margin-top: 60px;
  }
  
  .post-item {
    padding: 20px 0;
    border-bottom: 1px solid var(--post-border);
  }
  
  .post-item h2 {
    margin: 0 0 10px 0;
    font-family: 'Unbounded', sans-serif;
    font-size: 1.5rem;
  }
  
  .post-item h2 a {
    color: var(--text-color);
    text-decoration: none;
  }
  
  .post-item time {
    color: var(--text-color);
    opacity: 0.7;
    font-size: 0.9rem;
  }
  
  /* Responsive Critical Styles */
  @media (max-width: 768px) {
    .hero-headline { font-size: 3rem; }
    .container { padding: 0 20px; }
    .site-header { padding: 15px 20px; }
    .theme-toggle { left: 20px; }
    .main-site-link { right: 20px; }
  }
  
  @media (max-width: 480px) {
    .hero-headline { font-size: 2.2rem; }
    .container { padding: 0 15px; }
    .site-header { padding: 10px 15px; }
    .logo { font-size: 1.2rem; }
  }
</style>

<!-- Favicon and Icons -->
<link rel="icon" type="image/x-icon" href="/favicon.ico?v=2" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="shortcut icon" href="/favicon.ico?v=2" />
<link rel="manifest" href="/site.webmanifest">

<!-- RSS Feed -->
{{ range .AlternativeOutputFormats -}}
<link rel="{{ .Rel }}" type="{{ .MediaType.Type }}" href="{{ .Permalink | safeURL }}" title="{{ $.Site.Title }}">
{{ end -}}
