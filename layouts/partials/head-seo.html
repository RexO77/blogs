{{- $title := .Title -}}
{{- $description := .Description -}}
{{- $author := .Site.Params.author | default "Nischal Skanda" -}}
{{- $keywords := .Site.Params.keywords -}}

{{- if .IsHome -}}
    {{- $title = .Site.Params.metaTitle | default .Site.Title -}}
    {{- $description = .Site.Params.metaDescription | default .Site.Params.description -}}
{{- else if .IsPage -}}
    {{- $title = printf "%s | %s" .Title .Site.Title -}}
    {{- if not $description -}}
        {{- $description = .Summary | plainify | truncate 160 -}}
    {{- end -}}
{{- end -}}

<!-- Basic Meta Tags -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="{{ $description }}">
<meta name="keywords" content="{{ delimit $keywords ", " }}">
<meta name="author" content="{{ $author }}">
<meta name="robots" content="index, follow">
<meta name="language" content="{{ .Site.LanguageCode }}">

<!-- Title -->
<title>{{ $title }}</title>

<!-- Canonical URL -->
<link rel="canonical" href="{{ .Permalink }}">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
<meta property="og:url" content="{{ .Permalink }}">
<meta property="og:title" content="{{ $title }}">
<meta property="og:description" content="{{ $description }}">
<meta property="og:site_name" content="{{ .Site.Title }}">
<meta property="og:locale" content="{{ .Site.LanguageCode }}">

{{- if .IsPage -}}
<meta property="article:author" content="{{ $author }}">
<meta property="article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
{{- if .Lastmod -}}
<meta property="article:modified_time" content="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}">
{{- end -}}
{{- range .Params.tags -}}
<meta property="article:tag" content="{{ . }}">
{{- end -}}
{{- end -}}

<!-- Twitter Card -->
<meta name="twitter:card" content="{{ .Site.Params.twitterCard | default "summary_large_image" }}">
{{- with .Site.Params.twitter -}}
<meta name="twitter:site" content="{{ . }}">
<meta name="twitter:creator" content="{{ . }}">
{{- end -}}
<meta name="twitter:title" content="{{ $title }}">
<meta name="twitter:description" content="{{ $description }}">

<!-- Images for social media -->
{{- $ogImage := "" -}}
{{- if .Params.featured_image -}}
    {{- $ogImage = .Params.featured_image -}}
{{- else if .Site.Params.ogImage -}}
    {{- $ogImage = .Site.Params.ogImage -}}
{{- else -}}
    {{- $ogImage = "/images/og-default.jpg" -}}
{{- end -}}

{{- if $ogImage -}}
<meta property="og:image" content="{{ $ogImage | absURL }}">
<meta name="twitter:image" content="{{ $ogImage | absURL }}">
{{- end -}}

<!-- Additional SEO Meta Tags -->
<meta name="theme-color" content="#0099FF">
<meta name="msapplication-TileColor" content="#0099FF">

<!-- Search Engine Verification -->
<meta name="google-site-verification" content="{{ .Site.Params.googleSiteVerification }}">
<meta name="msvalidate.01" content="{{ .Site.Params.bingSiteVerification }}">
<meta name="yandex-verification" content="{{ .Site.Params.yandexVerification }}">

<!-- Enhanced Meta Tags for AI Content -->
{{- if .IsPage -}}
<meta name="article:reading_time" content="{{ math.Ceil (div (countwords .Content) 200.0) }}">
<meta name="article:word_count" content="{{ .WordCount }}">
{{- if .Params.keywords -}}
<meta name="news_keywords" content="{{ delimit .Params.keywords ", " }}">
{{- end -}}
{{- end -}}

<!-- Content Classification -->
<meta name="rating" content="general">
<meta name="distribution" content="global">
<meta name="revisit-after" content="7 days">

<!-- Performance & Crawling Hints -->
<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
<meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
<meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">

<!-- Web App Manifest -->
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="{{ .Site.Title }}">

<!-- Performance Hints -->
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="preconnect" href="{{ .Site.Params.mainSiteURL }}" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://www.google-analytics.com" crossorigin>

<!-- Security Headers -->
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">

<!-- Enhanced Structured Data (JSON-LD) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "{{ if .IsPage }}BlogPosting{{ else }}Blog{{ end }}",
  {{- if .IsPage -}}
  "headline": "{{ .Title }}",
  "description": "{{ $description }}",
  "author": {
    "@type": "Person",
    "name": "{{ $author }}",
    "url": "{{ .Site.Params.mainSiteURL }}",
    "sameAs": [
      "https://twitter.com/{{ .Site.Params.twitter | strings.TrimPrefix "@" }}",
      "https://linkedin.com/in/{{ .Site.Params.linkedin }}",
      "https://github.com/{{ .Site.Params.github }}"
    ]
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ .Site.Title }}",
    "url": "{{ .Site.BaseURL }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ .Site.BaseURL }}images/logo.png"
    }
  },
  "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
  {{- if .Lastmod -}}
  "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
  {{- end -}}
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ .Permalink }}"
  },
  {{- if $ogImage -}}
  "image": {
    "@type": "ImageObject",
    "url": "{{ $ogImage | absURL }}",
    "width": 1200,
    "height": 630
  },
  {{- end -}}
  "keywords": [{{ range $index, $tag := .Params.tags }}{{ if $index }}, {{ end }}"{{ $tag }}"{{ end }}],
  "articleSection": [{{ range $index, $cat := .Params.categories }}{{ if $index }}, {{ end }}"{{ $cat }}"{{ end }}],
  "wordCount": {{ .WordCount }},
  "inLanguage": "{{ .Site.LanguageCode }}",
  "copyrightYear": {{ .Date.Year }},
  "copyrightHolder": {
    "@type": "Person",
    "name": "{{ $author }}"
  }
  {{- else -}}
  "name": "{{ .Site.Title }}",
  "description": "{{ .Site.Params.description }}",
  "url": "{{ .Site.BaseURL }}",
  "author": {
    "@type": "Person",
    "name": "{{ $author }}",
    "url": "{{ .Site.Params.mainSiteURL }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ .Site.Title }}",
    "url": "{{ .Site.BaseURL }}"
  }
  {{- end -}}
}
</script>

<!-- Organization Schema -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "{{ .Site.Title }}",
  "url": "{{ .Site.BaseURL }}",
  "logo": "{{ .Site.BaseURL }}images/logo.png",
  "sameAs": [
    "https://twitter.com/{{ .Site.Params.twitter | strings.TrimPrefix "@" }}",
    "https://linkedin.com/in/{{ .Site.Params.linkedin }}",
    "https://github.com/{{ .Site.Params.github }}"
  ],
  "founder": {
    "@type": "Person",
    "name": "{{ .Site.Params.author }}"
  }
}
</script>

<!-- Website Schema -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "{{ .Site.Title }}",
  "url": "{{ .Site.BaseURL }}",
  "description": "{{ .Site.Params.description }}",
  "publisher": {
    "@type": "Organization",
    "name": "{{ .Site.Title }}"
  },
  "potentialAction": {
    "@type": "SearchAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": "{{ .Site.BaseURL }}search?q={search_term_string}"
    },
    "query-input": "required name=search_term_string"
  }
}
</script>

<!-- Performance Hints -->
<link rel="dns-prefetch" href="//vercel.com">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//www.google-analytics.com">
<link rel="preconnect" href="{{ .Site.Params.mainSiteURL }}">
<link rel="preconnect" href="https://vercel.com" crossorigin>

<!-- Critical CSS inlining hint -->
<style>
  /* Critical above-the-fold styles with design tokens */
  :root { 
    --space-lg: 2rem; --space-xl: 2.5rem; --text-2xl: 1.5rem; --text-5xl: 3rem;
    --transition-normal: 0.15s ease; --background-color: #F8F7F3; --text-color: #1a1a1a;
  }
  body { 
    margin: 0; padding-top: 80px; font-family: 'Satoshi', -apple-system, sans-serif;
    background-color: var(--background-color); color: var(--text-color);
  }
  .site-header { 
    position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
    background: rgba(248, 247, 243, 0.95); backdrop-filter: blur(10px);
    display: flex; justify-content: center; align-items: center; padding: var(--space-lg) var(--space-xl);
    transition: all var(--transition-normal);
  }
  .logo { 
    font-weight: 700; font-size: var(--text-2xl); font-family: 'Unbounded', sans-serif;
    position: absolute; left: 50%; transform: translateX(-50%); color: var(--text-color);
  }
  .hero-headline { 
    font-size: var(--text-5xl); line-height: 1.1; text-transform: uppercase; 
    font-weight: 700; font-family: 'Unbounded', sans-serif;
  }
  .fonts-loaded .hero-headline { font-size: 5rem; }
  @media (prefers-color-scheme: dark) {
    :root { --background-color: #0a0a0a; --text-color: #f5f5f5; }
    .site-header { background: rgba(10, 10, 10, 0.95); }
  }
</style>

<!-- Favicon and Icons -->
<link rel="icon" type="image/x-icon" href="/favicon.ico?v=2" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="shortcut icon" href="/favicon.ico?v=2" />
<link rel="manifest" href="/site.webmanifest">

<!-- RSS Feed -->
{{ range .AlternativeOutputFormats -}}
<link rel="{{ .Rel }}" type="{{ .MediaType.Type }}" href="{{ .Permalink | safeURL }}" title="{{ $.Site.Title }}">
{{ end -}}
