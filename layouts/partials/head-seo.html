{{- $title := .Title -}}
{{- $description := .Description | default .Params.description -}}
{{- $author := .Site.Params.author | default "Nischal Skanda" -}}
{{- $keywords := .Site.Params.keywords -}}

{{- if .IsHome -}}
  {{- $title = .Site.Params.metaTitle | default .Site.Title -}}
  {{- $description = .Site.Params.metaDescription | default .Site.Params.description -}}
{{- else if .IsPage -}}
  {{- $title = printf "%s | %s" .Title .Site.Title -}}
  {{- if not $description -}}
    {{- $description = .Summary | plainify | truncate 160 -}}
  {{- end -}}
{{- end -}}

{{- if not $description -}}
  {{- $description = .Site.Params.description | default .Site.Title -}}
{{- end -}}

{{- $keywordContent := delimit $keywords ", " -}}
{{- if .IsPage -}}
  {{- $pageKeywordContent := "" -}}
  {{- with .Params.tags -}}
    {{- $pageKeywordContent = delimit . ", " -}}
  {{- end -}}
  {{- with .Params.categories -}}
    {{- if $pageKeywordContent -}}
      {{- $pageKeywordContent = printf "%s, %s" $pageKeywordContent (delimit . ", ") -}}
    {{- else -}}
      {{- $pageKeywordContent = delimit . ", " -}}
    {{- end -}}
  {{- end -}}
  {{- if $pageKeywordContent -}}
    {{- $keywordContent = $pageKeywordContent -}}
  {{- end -}}
{{- end -}}

{{- $ogImage := .Site.Params.ogImage | default "/apple-touch-icon.png" -}}
{{- with .Params.featured_image -}}
  {{- if ne . "" -}}
    {{- $ogImage = . -}}
  {{- end -}}
{{- end -}}

<!-- Basic Meta Tags -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="{{ $description }}">
<meta name="keywords" content="{{ $keywordContent }}">
<meta name="author" content="{{ $author }}">
<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
<meta name="language" content="{{ .Site.LanguageCode }}">

<!-- Title -->
<title>{{ $title }}</title>

<!-- Canonical URL -->
<link rel="canonical" href="{{ .Permalink }}">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
<meta property="og:url" content="{{ .Permalink }}">
<meta property="og:title" content="{{ $title }}">
<meta property="og:description" content="{{ $description }}">
<meta property="og:site_name" content="{{ .Site.Title }}">
<meta property="og:locale" content="{{ .Site.LanguageCode }}">

{{- if .IsPage -}}
<meta property="article:author" content="{{ $author }}">
<meta property="article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
{{- if .Lastmod -}}
<meta property="article:modified_time" content="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}">
{{- end -}}
{{- range .Params.tags -}}
<meta property="article:tag" content="{{ . }}">
{{- end -}}
{{- end -}}

<!-- Twitter Card -->
<meta name="twitter:card" content="{{ .Site.Params.twitterCard | default "summary_large_image" }}">
{{- with .Site.Params.twitter -}}
<meta name="twitter:site" content="{{ . }}">
<meta name="twitter:creator" content="{{ . }}">
{{- end -}}
<meta name="twitter:title" content="{{ $title }}">
<meta name="twitter:description" content="{{ $description }}">

<!-- Images for social media -->
{{- if $ogImage -}}
<meta property="og:image" content="{{ $ogImage | absURL }}">
<meta name="twitter:image" content="{{ $ogImage | absURL }}">
{{- end -}}

<!-- Additional SEO Meta Tags -->
<meta name="theme-color" content="#0099FF">
<meta name="msapplication-TileColor" content="#0099FF">

<!-- Performance & Crawling Hints -->
<meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
<meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">

<!-- Web App Manifest -->
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="{{ .Site.Title }}">

<!-- Performance Hints - DNS Prefetch and Preconnect (consolidated) -->
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="//vercel.com">
<link rel="dns-prefetch" href="//www.google-analytics.com">
<link rel="preconnect" href="{{ .Site.Params.mainSiteURL }}" crossorigin>
<link rel="preconnect" href="https://vercel.com" crossorigin>

<!-- Structured Data (JSON-LD) -->
{{- $schemaTags := .Params.tags | default (slice) -}}
{{- $schemaCategories := .Params.categories | default (slice) -}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": {{ if .IsPage }}"BlogPosting"{{ else }}"Blog"{{ end }},
  {{- if .IsPage -}}
  "headline": {{ .Title | jsonify | safeJS }},
  "description": {{ $description | jsonify | safeJS }},
  "author": {
    "@type": "Person",
    "name": {{ $author | jsonify | safeJS }},
    "url": {{ .Site.Params.mainSiteURL | jsonify | safeJS }}
  },
  "publisher": {
    "@type": "Organization",
    "name": {{ .Site.Title | jsonify | safeJS }},
    "url": {{ .Site.BaseURL | jsonify | safeJS }}
  },
  "datePublished": {{ .Date.Format "2006-01-02T15:04:05Z07:00" | jsonify | safeJS }},
  {{- if .Lastmod -}}
  "dateModified": {{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" | jsonify | safeJS }},
  {{- end -}}
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": {{ .Permalink | jsonify | safeJS }}
  },
  "image": {{ ($ogImage | absURL) | jsonify | safeJS }},
  "keywords": {{ $schemaTags | jsonify | safeJS }},
  "articleSection": {{ $schemaCategories | jsonify | safeJS }}
  {{- else -}}
  "name": {{ .Site.Title | jsonify | safeJS }},
  "description": {{ (.Site.Params.description | default .Site.Title) | jsonify | safeJS }},
  "url": {{ .Site.BaseURL | jsonify | safeJS }},
  "author": {
    "@type": "Person",
    "name": {{ $author | jsonify | safeJS }},
    "url": {{ .Site.Params.mainSiteURL | jsonify | safeJS }}
  },
  "publisher": {
    "@type": "Organization",
    "name": {{ .Site.Title | jsonify | safeJS }},
    "url": {{ .Site.BaseURL | jsonify | safeJS }}
  }
  {{- end -}}
}
</script>

<!-- Critical CSS inlining hint -->
<style>
  /* Critical above-the-fold styles with design tokens */
  :root { 
    --space-lg: 2rem; --space-xl: 2.5rem; --text-2xl: 1.5rem; --text-5xl: 3rem;
    --transition-normal: 0.15s ease; --background-color: #F8F7F3; --text-color: #1a1a1a;
  }
  body { 
    margin: 0; padding-top: 80px; font-family: 'Satoshi', -apple-system, sans-serif;
    background-color: var(--background-color); color: var(--text-color);
  }
  .site-header { 
    position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
    background: rgba(248, 247, 243, 0.95); backdrop-filter: blur(10px);
    display: flex; justify-content: center; align-items: center; padding: var(--space-lg) var(--space-xl);
    transition: all var(--transition-normal);
  }
  .logo { 
    font-weight: 700; font-size: var(--text-2xl); font-family: 'Unbounded', sans-serif;
    position: absolute; left: 50%; transform: translateX(-50%); color: var(--text-color);
  }
  .hero-headline { 
    font-size: var(--text-5xl); line-height: 1.1; text-transform: uppercase; 
    font-weight: 700; font-family: 'Unbounded', sans-serif;
  }
  .fonts-loaded .hero-headline { font-size: 5rem; }
  @media (prefers-color-scheme: dark) {
    :root { --background-color: #0a0a0a; --text-color: #f5f5f5; }
    .site-header { background: rgba(10, 10, 10, 0.95); }
  }
</style>

<!-- Favicon and Icons -->
<link rel="icon" type="image/x-icon" href="/favicon.ico?v=2" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="shortcut icon" href="/favicon.ico?v=2" />
<link rel="manifest" href="/site.webmanifest">

<!-- RSS Feed -->
{{ range .AlternativeOutputFormats -}}
<link rel="{{ .Rel }}" type="{{ .MediaType.Type }}" href="{{ .Permalink | safeURL }}" title="{{ $.Site.Title }}">
{{ end -}}
